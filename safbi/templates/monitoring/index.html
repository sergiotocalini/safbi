{% extends "base.html" %}

{% block title %}Monitoring{% endblock %}

{% block body %}
<div class="section-refresh fade in disabled"
     style="width:100%;height:100%;opacity:0.7;background-color:#dedede;
	    position:absolute;z-index:10;">
  <i class="fa fa-5x fa-spinner fa-spin"
     style="top:48%;left:48%;transform: translateY(-50%) translateX(-50%);
	    position:absolute"></i>
</div>
<div class="dashboard-header section-header">
  <div class="section-title title">
    <i class="fa fa-fw fa-chalkboard" aria-hidden="true"></i>
    Monitoring: Overview
  </div>
  <div class="section-toolbar toolbar pull-right">
    <a data-init="true" href="#fullscreen" data-click="section-fullscreen"
       aria-disabled="true" title="Fullscreen">
      <i class="fa fa-2x fa-expand-arrows-alt"></i>
    </a>    
    <a data-init="true" href="#filter" data-click="section-filter"
       aria-disabled="true" title="Filter">
      <i class="fa fa-2x fa-cog"></i>
      <span id="section-toolbar-filter-badge" class="badge badge-primary"></span>
    </a>
    <a data-init="true" href="#refresh" data-click="section-refresh"
       aria-disabled="true" title="Refresh">
      <i class="fa fa-2x fa-sync"></i>
    </a>
  </div>    
</div>
<div class="capacity-content section-content" style="background: #f1f2f7;">
  <div class="grid-stack" data-gs-animate="true">

    <div class="grid-stack-item" data-gs-width="3" data-gs-height="2" data-gs-x="0" data-gs-y="0"
	 data-gs-no-move="true"	data-gs-no-resize="true" style="padding: 0.5% !important;">
      <div class="panel" style="border:0px;margin:0px;height:100%;width:100%;">
	<div class="panel-body" style="padding:0px;height:100%;width:100%;">
	  <div class="grid-stack-item-content" style="height:100%;width:100%;">

	    <div class="info-box" id="problem-box-count">
	      <span class="icon bg-danger text-white">
		<i class="fa fa-exclamation-triangle"></i>
	      </span>
	      <div class="content">
		<div class="title">Problems</div>
		<div class="text">0</div>
	      </div>
	    </div>
	    
	  </div>	  
	</div>
      </div>
    </div>

    <div class="grid-stack-item" data-gs-width="3" data-gs-height="2" data-gs-x="3" data-gs-y="0"
	 data-gs-no-move="true"	data-gs-no-resize="true" style="padding: 0.5% !important;">
      <div class="panel" style="border:0px;margin:0px;height:100%;width:100%;">
	<div class="panel-body" style="padding:0px;height:100%;width:100%;">
	  <div class="grid-stack-item-content" style="height:100%;width:100%;">

	    <div class="info-box" id="inventory-box-hosts-count">
	      <span class="icon bg-primary text-white">
		<i class="fa fa-server"></i>
	      </span>
	      <div class="content">
		<div class="title">Hosts</div>
		<div class="text">0</div>
	      </div>
	    </div>
	    
	  </div>	  
	</div>
      </div>
    </div>    
    
    <div class="grid-stack-item" data-gs-width="3" data-gs-height="2" data-gs-x="6" data-gs-y="0"
	 data-gs-no-move="true" data-gs-no-resize="true" style="padding: 0.5% !important;">
      <div class="panel" style="border:0px;margin:0px;height:100%;width:100%;">
	<div class="panel-body" style="padding:0px;height:100%;width:100%;">
	  <div class="grid-stack-item-content" style="height:100%;width:100%;">
	    
	    <div class="info-box" id="inventory-box-sites-count">
	      <span class="icon bg-info text-white">
		<i class="fa fa-building"></i>
	      </span>
	      <div class="content">
		<div class="title">Sites</div>
		<div class="text">0</div>
	      </div>
	    </div>	    
	    
	  </div>
	</div>
      </div>
    </div>
    
    <div class="grid-stack-item" data-gs-width="3" data-gs-height="2" data-gs-x="9" data-gs-y="0"
	 data-gs-no-move="true" data-gs-no-resize="true" style="padding: 0.5% !important;">
      <div class="panel" style="border:0px;margin:0px;height:100%;width:100%;">
	<div class="panel-body" style="padding:0px;height:100%;width:100%;">
	  <div class="grid-stack-item-content" style="height:100%;width:100%;">

	    <div class="info-box" id="datasources-box-count">
	      <span class="icon bg-secondary text-white">
		<i class="fa fa-plug"></i>
	      </span>
	      <div class="content">
		<div class="title">Datasources</div>
		<div class="text">1</div>
	      </div>
	    </div>	    
	    
	  </div>
	</div>
      </div>
    </div>

    <div class="grid-stack-item" data-gs-width="12" data-gs-height="18" data-gs-x="0" data-gs-y="2"
	 data-gs-no-move="true" data-gs-no-resize="true" style="padding: 0.5% !important;">
      <div class="panel" style="border:0px;margin:0px;height:100%;width:100%;">
      	<div class="panel-body" style="padding:0px;height:100%;width:100%;">
	  <div class="grid-stack-item-content" style="height:100%;width:100%;">
	    <div class="problems-box table-responsive" style="height:100%;padding:0.25%;">
	      <table id="problem-box-table"
		 data-show-toggle="false" data-show-export="false"
		 data-show-columns="false"
		 data-sort-name="lastchange" data-sort-order="desc"
		 data-toggle="table" data-striped="true"
		 data-escape="false"
		 data-show-pagination-switch="false"
		 data-detail-view="false"
		 class="table-hover table-striped table-compact table-responsive
			table-condensed table-autosize">
		<thead>
		  <tr>
		    <th data-field="lastchange" data-valign="middle"
			data-align="center" data-sortable="true"
			data-formatter="ProblemFormatterDate">
		      <i class="fa fa-fw fa-calendar-alt"></i>
		      Date
		    </th>
		    <th data-field="site" data-valign="middle"
			data-align="center" data-sortable="true">
		      <i class="fa fa-fw fa-building"></i>
		      Site
		    </th>
		    <th data-field="priority" data-valign="middle"
			data-align="center" data-sortable="true" data-cell-style="cellStyle"
			data-formatter="ProblemFormatterPriority">
		      <i class="fa fa-fw fa-question-circle"></i>
		      Priority
		    </th>
		    <th data-field="value" data-valign="middle"
			data-align="center" data-sortable="true"
			data-formatter="ProblemFormatterStatus">
		      <i class="fa fa-fw fa-exclamation-triangle"></i>
		      Status
		    </th>		    
		    <th data-field="host" data-valign="middle" data-halign="center"
			data-align="left" data-sortable="true"
			data-formatter="ProblemFormatterHost">
		      <i class="fa fa-fw fa-server"></i>
		      Host
		    </th>
		    <th data-field="description" data-align="left" data-halign="center" 
			data-valign="middle" data-sortable="true" data-visible="true"
			data-formatter="ProblemFormatterDescription">
		      <i class="fa fa-fw fa-list-ul"></i>
		      Description
		    </th>
		    <th data-field="actions" data-align="center" 
			data-valign="middle">
		      <i class="fa fa-fw fa-user-cog"></i>
		    </th>
		  </tr>
		</thead>
		<tbody>
		</tbody>
	      </table>
	    </div>
	   
	  </div>
      	</div>
      </div>
    </div>
    
  </div>
</div>   
{% endblock %}

{% block scripts %}
<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js" type="text/javascript"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js"></script>

<link href="{{ config['CDN_LOCAL'] }}/extras/gridstack/0.3.0/css/gridstack.min.css"
      rel="stylesheet"/>
<script src="{{ config['CDN_LOCAL'] }}/extras/gridstack/0.3.0/js/gridstack.all.js">
</script>
<script src="{{ config['CDN_LOCAL'] }}/extras/gridstack/0.3.0/js/gridstack.jQueryUI.js"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>

<link  href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.css" rel="stylesheet">
<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.js">
</script>

<script>
$(document).ready(function () {
    var WIDGET_DATA = { problems: [], inventory: [] };
    $('.grid-stack').gridstack({verticalMargin: 0});
    autosize_tables();

    $(window).resize(function () {
	jqlisteners();
    });    
    
    $(document).on("click", "[data-click=section-fullscreen]", function(a) {
	a.preventDefault();
	$('.wrapper').toggleClass('fullscreen');
	$('.header-bar').toggleClass('hidden');
	$('.sidebar').toggleClass('hidden');
	$('.footer-bar').toggleClass('hidden');
	autosize_tables();
    });
    
    refreshFrame();
});

{% include "js/common.js" %}
{% include "monitoring/index.js" %}

function jqlisteners() {
    console.log("Refresh")
};

</script>
{% endblock %}
